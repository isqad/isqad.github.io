<!doctype html>
<html>
  <head>
    <title>Лежа на диване с ноутбуком и паяльником</title>
  </head>
  <body>
<h1><a id="_UBS_0"></a>Интерфейс USB</h1>
<h2><a id="__2"></a>Общие сведения</h2>
<p>USB - последовательный интерфейс, в основе которого лежат такие<br>
понятия, как “главное” и “переферийное” устройства.</p>
<p>Логика у них принципиально отличается, и нельзя подключить<br>
к главному главное, а к переферийному переферийное устройства.<br>
Есть специальные usb-хабы, которые подключаются как клиенты к<br>
хосту, но ведут себя хостом для других подключаемых к хабу<br>
устройств.</p>
<h2><a id="__13"></a>Физический уровень</h2>
<p>Физически USB устроен из 4 проводников: земля (GND), +5В(VBUS),<br>
D+, D-. Первые два могут использоваться для питания периферийного<br>
устройства (макс. ток пол-ампера для USB2.0, для USB3.0 до 0.9А).<br>
D+ и D- используются для передачи данных, “+” и “-” в обозначении<br>
никак с электрическими потенциалами не связаны.</p>
<h3><a id="_21"></a>Особенности:</h3>
<ol>
<li>
<p>Сначала подается питание на переферийное устройство, затем только<br>
подключаются контакты передачи данных. Сам разъем так устроен, что<br>
первыми заходят контакты GND и VBUS, и только потом D+ и D-.</p>
</li>
<li>
<p>Чтобы хост определил, что к нему подключилось устройство,<br>
необходимо “заявить о себе” подтяжкой линии D+ к 3.3В через 1.5кОм.<br>
Если убрать такую подтяжку, хост определит отключени устройства.<br>
Подтяжкой можно управлять через ключ, “дергая” ножкой микроконтроллера,<br>
тогда устройство сможет самостоятельно подключаться и отключаться от<br>
хоста</p>
</li>
</ol>
<h2><a id="__34"></a>Логический уровень</h2>
<p>Обмен данными происходит через виртуальные каналы (EndPoints).<br>
Их 4 вида:</p>
<p>Control - канал для управления переферийным устройством.</p>
<p>Bulk - для обмена данными. Гарантя целостности данных реализована<br>
“в железе”. Скорость передачи по такому каналу ограничена.</p>
<p>Isochronous - используется для обмена потоковыми данными. Целостность<br>
данных не гарантируется, зато скорость выше.</p>
<p>Interrupt - используется для реализации подобия “прерываний”.<br>
Прерывания эти логические и никак не связаны с аппаратными<br>
прерываниями микроконтроллера или прерываниями операционной системы.</p>
<p>Типы каналов и их количество определяет разработчик устройства.<br>
Минимальная реализация предусматривает наличие только Control<br>
канала.</p>
<p>Есть стандартизированные классы USB устройств. Для каждого такого<br>
класса количество и типы каналов установлены стандартом.</p>
<h3><a id="TODO_____USB____58"></a>TODO: привести примеры различных классов USB-устройств с их особенностями</h3>
<p>В качестве примера возьмем устройство класса CDC (communications<br>
device class).</p>
  </body>
</html>
